==========================================
MOLTSPIN V2 - WHAT'S NEW
==========================================

MAJOR UPGRADES FROM V1:
==========================================

1. CHAINLINK VRF INTEGRATION
   - V1: Block hash randomness (vulnerable to miner manipulation)
   - V2: Chainlink VRF (cryptographically secure, verifiable randomness)
   - Impact: True provably fair gaming

2. BATCH BETTING
   - V1: One bet per transaction
   - V2: Up to 10 bets in single transaction
   - Impact: Better UX, lower gas costs, realistic casino experience

3. VARIABLE MIN BETS
   - V1: Single 1 USDC min bet for all bet types
   - V2: Different minimums per bet type:
     * Straight: 1 USDC
     * Even money: 5 USDC
     * Dozens/columns: 2 USDC
   - Impact: Better risk management, encourages riskier bets

4. ASYNC SETTLEMENT
   - V1: Instant settlement (same transaction)
   - V2: Async settlement (VRF callback)
   - Impact: Truly random, unpredictable results

5. ENHANCED SECURITY
   - V1: Basic checks
   - V2: Pause mechanism, adjustable min bets, enhanced validations
   - Impact: Better risk control for house

==========================================
TECHNICAL CHANGES:
==========================================

NEW DEPENDENCIES:
- @chainlink/contracts (VRF)
- VRFConsumerBaseV2 inheritance
- VRFCoordinatorV2Interface

NEW STATE:
- VRF subscription ID
- Key hash for VRF
- Request ID to batch ID mapping
- Pause state
- Variable min bets per type

NEW STRUCTS:
- BetBatch (groups related bets)
- BetInput (for batch betting)

NEW EVENTS:
- BatchCreated
- VRFRequested
- VRFFulfilled
- BetSettled (individual)
- MinBetUpdated
- PauseToggled

NEW FUNCTIONS:
- placeBets(BetInput[] calldata) - Batch betting
- fulfillRandomWords() - VRF callback
- setMinBet*() - Adjust minimums
- togglePause() - Emergency stop

REMOVED:
- Auto-spin in same transaction
- Direct randomness generation

==========================================
WORKFLOW CHANGES:
==========================================

V1 FLOW:
1. User calls betRed(amount)
2. Contract generates random number
3. Result calculated
4. Payout sent
5. All in one transaction

V2 FLOW:
1. User calls betRed(amount) OR placeBets([...])
2. Contract transfers USDC, creates batch
3. Request sent to Chainlink VRF
4. User waits ~30-60 seconds
5. VRF calls fulfillRandomWords()
6. Results calculated
7. Payouts sent
8. Events emitted

==========================================
COST IMPLICATIONS:
==========================================

V1 COSTS:
- Gas only (~$0.10 per bet on Base)

V2 COSTS:
- Gas (~$0.10 per bet)
- VRF fee (~$1-2 per batch in LINK)
- LINK subscription required

OPTIMIZATION:
- Batch betting reduces per-bet cost
- Single VRF call for multiple bets

==========================================
FRONTEND CHANGES REQUIRED:
==========================================

1. Update contract ABI
2. Handle async results (listen for SpinResult event)
3. Show "spinning" UI while waiting for VRF
4. Support batch bet selection
5. Display different min bets per bet type
6. Handle pause state

EVENT SUBSCRIPTIONS:
- BatchCreated → Show bet placed
- VRFRequested → Show "spinning" animation
- SpinResult → Show result and payout
- BetSettled → Show individual bet outcomes

==========================================
MIGRATION GUIDE:
==========================================

DEPLOY NEW CONTRACT:
- V1 and V2 can coexist
- Don't need to migrate V1 data
- Start fresh with V2

FRONTEND UPDATE:
1. Update contract address in .env
2. Update ABI import
3. Add VRF waiting state
4. Add batch betting UI
5. Update min bet validation

HOUSE MANAGEMENT:
- Fund V2 house separately
- Can withdraw from V1 if needed
- Monitor LINK balance for VRF

==========================================
BACKWARDS COMPATIBILITY:
==========================================

SINGLE BETS STILL WORK:
- betRed(), betBlack(), betStraight(), etc.
- Internally creates single-bet batch
- Same function signatures
- Easier migration for existing integrations

==========================================
TESTING CHECKLIST:
==========================================

□ Deploy contract
□ Create VRF subscription
□ Add contract as consumer
□ Fund subscription with LINK
□ Fund house with USDC
□ Test single bet (betRed)
□ Wait for VRF callback
□ Verify SpinResult event
□ Test batch bet (3-5 bets)
□ Test min bet enforcement per type
□ Test pause mechanism
□ Test min bet updates
□ Monitor LINK consumption
□ Verify gas costs
□ Test emergency withdraw

==========================================
RECOMMENDED SETTINGS:
==========================================

HOUSE BALANCE:
- Start with 10,000 USDC minimum
- Covers worst case: 10x straight bets winning
- Monitor and refill as needed

LINK BALANCE:
- Start with 5 LINK in subscription
- ~50-100 spins worth
- Set up monitoring/alerts

MIN BETS:
Production recommendations:
- Straight: 1-2 USDC (allows small players)
- Even money: 5-10 USDC (covers VRF cost)
- Dozens: 2-5 USDC (middle ground)

Adjust based on:
- VRF cost trends
- House edge profit
- User behavior

==========================================
KEY BENEFITS OF V2:
==========================================

FOR PLAYERS:
✅ Truly provably fair (Chainlink VRF)
✅ Batch betting (realistic casino experience)
✅ Verifiable randomness on-chain
✅ Same payout structure

FOR HOUSE:
✅ Enhanced security
✅ Flexible min bets
✅ Pause mechanism
✅ Better risk management
✅ Adjustable parameters

FOR DEVELOPERS:
✅ Rich event system
✅ Better state management
✅ Production-ready randomness
✅ Gas-optimized batching

==========================================
WHEN TO USE V1 VS V2:
==========================================

USE V1 IF:
- Testing/development
- Don't want VRF costs
- Need instant results
- Simple single bets only

USE V2 IF:
- Production deployment
- Need provable fairness
- Want batch betting
- Professional casino experience
- Can cover VRF costs from edge

RECOMMENDATION: Use V2 for production launch
==========================================
